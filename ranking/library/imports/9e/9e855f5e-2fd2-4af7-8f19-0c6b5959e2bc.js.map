{"version":3,"sources":["assets\\openData.js"],"names":["cc","Class","Component","properties","content","type","Node","item","Prefab","onLoad","self","wx","onMessage","data","console","log","text","getFriendInfo","removeAllChildren","friendList","Array","getFriendCloudStorage","keyList","success","res","i","length","nickName","nickname","avatarUrl","score","KVDataList","push","createRank","fail","sort","a","b","createItem","index","instantiate","children","getComponent","Label","string","String","loader","load","url","err","texture","error","Sprite","spriteFrame","SpriteFrame","addChild"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        content: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n\r\n        item: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n        }\r\n    },\r\n\r\n\r\n    /**\r\n     * 接受主域消息\r\n     */\r\n    onLoad() {\r\n        var self = this;\r\n        wx.onMessage(function (data){\r\n            console.log('子域收到信息：');\r\n            console.log(data);\r\n\r\n            if(data.text == 'showRank') {\r\n                self.getFriendInfo(); // 获取好友信息\r\n            } else if(data.text == 'clear') {\r\n                self.content.removeAllChildren(); // 清空排行榜\r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * 获取好友信息\r\n     */\r\n    getFriendInfo() {\r\n        this.friendList = new Array();\r\n        var self = this;\r\n\r\n        wx.getFriendCloudStorage({\r\n            keyList: ['totalPassed'],\r\n            success: (res) => {\r\n                for (var i = 0; i < res.data.length; i++) {\r\n                    // 获取玩家微信名，头像url和通关数\r\n                    var nickName = res.data[i].nickname;\r\n                    var avatarUrl = res.data[i].avatarUrl;\r\n                    var score = 0;\r\n                    if (res.data[i].KVDataList.length)\r\n                        score = res.data[i].KVDataList[0]['value'];\r\n     \r\n                    // 加入到数组中\r\n                    self.friendList.push({\r\n                        nickName: nickName,\r\n                        avatarUrl: avatarUrl,\r\n                        score: score\r\n                    });\r\n                }\r\n\r\n                self.createRank(); // 创建列表\r\n\r\n                console.log('获得好友微信数据成功（数组）');\r\n                console.log(res);\r\n            },\r\n     \r\n            fail: (res) => {\r\n                console.log('获得好友微信数据失败');\r\n                console.log(res);\r\n            }\r\n    \r\n        });\r\n    },\r\n   \r\n    /**\r\n     * 创建好友列表\r\n     */\r\n    createRank() {\r\n        // 将friendList内部元素进行排序，根据分数来降序排列\r\n        this.friendList.sort((a, b) => {\r\n            return b['score'] - a['score'];\r\n        });\r\n\r\n        // 创建item元素\r\n        for(var i = 0; i < this.friendList.length; i++) {\r\n            var nickName = this.friendList[i]['nickName'];\r\n            var avatarUrl = this.friendList[i]['avatarUrl'];\r\n            var score = this.friendList[i]['score'];\r\n            this.createItem(i+1, nickName, avatarUrl, score);\r\n        }\r\n    },\r\n\r\n    createItem(index, nickName, avatarUrl, score) {\r\n        var item = cc.instantiate(this.item);  \r\n        // 排名\r\n        item.children[0].getComponent(cc.Label).string = String(index);\r\n        // 微信名\r\n        item.children[1].getComponent(cc.Label).string = nickName;\r\n        // 分数\r\n        item.children[2].getComponent(cc.Label).string = score;\r\n        // 头像\r\n        cc.loader.load({url: avatarUrl, type: 'png'}, (err, texture) => {\r\n            if(err) {\r\n                console.error(err);\r\n            }\r\n            item.children[3].children[0].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n    \r\n        // 添加到content中\r\n        this.content.addChild(item);\r\n\r\n    }\r\n\r\n\r\n});\r\n"]}