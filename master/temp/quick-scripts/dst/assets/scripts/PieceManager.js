
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/PieceManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b4b07vA7axPm7uuiHi3YyxC', 'PieceManager');
// scripts/PieceManager.js

"use strict";

/**
 * 管理所有棋子的类
 * 
 * @property {cc.Node[]} map 存所有格子引用的数组
 * 
 * @property {cc.Node[]} pieces 存所有棋子引用的数组
 */
cc.Class({
  "extends": cc.Component,

  /**
   * 初始化
   */
  start: function start() {
    this.pieces = [];
    this.pieces = this.node.getChildren(); // 获取所有格子对象的引用

    this.map = this.node.parent.getComponent("CheckerBoard").map; // 将每个格子的引用传递到棋子上

    for (var i in this.pieces) {
      this.pieces[i].grids = this.map;
    }
  },

  /**
   * 根据格子的状态点亮格子
   */
  enlighten: function enlighten() {
    var grids = this.map;

    for (var i = 0; i < 10; i++) {
      for (var j = 0; j < 10; j++) {
        var grid = grids[i][j];
        if (grid.flag == 0) continue;

        if (grid.nums > 0) {
          grid.flag = 2;
        } else {
          grid.flag = 1;
        } // 发送事件信息，调用repaint方法


        grid.emit("flag_changed");
      }
    }
  },

  /**
   * 通关后禁止所有棋子的脚本
   */
  stopAction: function stopAction() {
    for (var i in this.pieces) {
      this.pieces[i].getComponents(cc.Component)[1].destroy();
    }
  },

  /**
  * 检查是否通关
  * @returns {Boolean} 通关返回true, 反之返回false
  */
  checkPass: function checkPass() {
    var canvas = cc.find('Canvas');
    var path = canvas.getComponents(cc.Component)[1].path;
    var grids = this.map;

    for (var i = 0; i < 10; i++) {
      for (var j = 0; j < 10; j++) {
        if (path[i][j] == 1 && grids[i][j].flag != 2) {
          return false;
        }
      }
    }

    return true;
  },

  /**
   * 过关动画呈现
   */
  show: function show() {
    var canvas = cc.find('Canvas');
    var grids = this.map;
    var path = canvas.getComponents(cc.Component)[1].path; // 查找起始点

    var begin = function () {
      for (var i = 0; i < 10; i++) {
        if (path[9][i] == 1) return cc.v2(9, i);
      }

      for (var i = 9; i >= 0; i--) {
        if (path[i][0] == 1) return cc.v2(i, 0);
      }

      for (var i = 0; i < 10; i++) {
        if (path[0][i] == 1) return cc.v2(0, i);
      }

      for (var i = 0; i < 10; i++) {
        if (path[i][9] == 1) return cc.v2(i, 9);
      }

      return null;
    }(); // 顺序获取路径上每格


    var dirx = new Array(0, 1, 0, -1);
    var diry = new Array(1, 0, -1, 0);
    var vist = new Array();
    var paint = new Array();
    vist[begin] = true;

    for (var nx = begin.x, ny = begin.y;;) {
      paint.push(grids[nx][ny]);
      var flag = false;

      for (var i = 0; i < 4; i++) {
        var x = nx + dirx[i];
        var y = ny + diry[i];
        var t = cc.v2(x, y);

        if (x < 10 && x >= 0 && y < 10 && y >= 0 && path[x][y] == 1 && !vist.hasOwnProperty(t)) {
          vist[t] = true;
          nx = x, ny = y;
          flag = true;
          break;
        }
      } // 当前已经是最后一个格子


      if (!flag) break;
    } // 更改格子背景


    cc.loader.loadRes("grid/pass", cc.SpriteFrame, function (err, spriteFrame) {
      for (var index in paint) {
        (function (index, obj, pic) {
          // 通过回调函数间隔更换背景
          obj.getComponent('Grid').scheduleOnce(function () {
            obj.getComponent(cc.Sprite).spriteFrame = pic;
          }, index * 0.018);
        })(index, paint[index], spriteFrame);
      }
    });
  },

  /**
   * 通关后执行行为
   */
  passedAction: function passedAction() {
    // 禁止棋子拖动
    this.stopAction(); // 过关弹窗

    var self = this.node;
    cc.loader.loadRes("alert", cc.Prefab, function (err, prefab) {
      var alert = cc.instantiate(prefab);
      self.parent.addChild(alert);
      alert.setPosition(cc.v2(0, -452.5));
    });
    this.show(); // 通关音效

    cc.loader.loadRes("music/pass", cc.AudioClip, function (err, clip) {
      cc.audioEngine.play(clip, false, 1);
    }); // 禁用帮助按钮

    if (cc.find('Canvas/TipButton')) cc.find('Canvas/TipButton').active = false; // 记录通过的关卡到缓存

    var canvas = cc.find('Canvas');
    var index = canvas.getComponents(cc.Component)[1].index;
    cc.sys.localStorage.setItem('Level' + index, true); // 更新缓存通关总数

    var cnt = 0;

    for (var i = 1; i <= 45; i++) {
      if (cc.sys.localStorage.getItem('Level' + i)) {
        cnt++;
      }
    }

    var pastCnt = cc.sys.localStorage.getItem('totalPassed');

    if (pastCnt == null && pastCnt < cnt) {
      cc.sys.localStorage.setItem('totalPassed', cnt);
    } // TX云存储当前用户的总过关数


    if (window['wx']) {
      var kvDataList = new Array();
      kvDataList.push({
        //标签 存储的当前游戏种类的标签
        key: 'totalPassed',
        value: String(cnt)
      });
      wx.setUserCloudStorage({
        KVDataList: kvDataList,
        success: function success(e) {
          console.log('向wx存储用户数据成功');
          console.log(e);
        },
        fail: function fail(e) {
          console.log('向wx存储用户数据失败');
          console.log(e);
        }
      });
    }
  },

  /**
   * 更新所有棋子
   */
  updateAll: function updateAll() {
    // 重置方格
    for (var i = 0; i < 10; i++) {
      for (var j = 0; j < 10; j++) {
        this.map[i][j].nums = 0;
      }
    } // 将棋盘内所有红棋设为生效


    for (var i in this.pieces) {
      var piece = this.pieces[i];

      if (piece.type == 0 && piece.isInRange) {
        piece.disable = false;
      }
    } // 更新黑棋以禁用受攻击的红棋


    for (var i in this.pieces) {
      var piece = this.pieces[i];

      if (piece.type == 1) {
        piece.getComponents(cc.Component)[1].setflag(piece.gx, piece.gy);
      }
    } // 更新红棋


    for (var i in this.pieces) {
      var piece = this.pieces[i];

      if (piece.type == 0 && piece.isInRange && piece.disable == false) {
        piece.getComponents(cc.Component)[1].setflag(1, piece.gx, piece.gy);
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0c1xcUGllY2VNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJzdGFydCIsInBpZWNlcyIsIm5vZGUiLCJnZXRDaGlsZHJlbiIsIm1hcCIsInBhcmVudCIsImdldENvbXBvbmVudCIsImkiLCJncmlkcyIsImVubGlnaHRlbiIsImoiLCJncmlkIiwiZmxhZyIsIm51bXMiLCJlbWl0Iiwic3RvcEFjdGlvbiIsImdldENvbXBvbmVudHMiLCJkZXN0cm95IiwiY2hlY2tQYXNzIiwiY2FudmFzIiwiZmluZCIsInBhdGgiLCJzaG93IiwiYmVnaW4iLCJ2MiIsImRpcngiLCJBcnJheSIsImRpcnkiLCJ2aXN0IiwicGFpbnQiLCJueCIsIngiLCJueSIsInkiLCJwdXNoIiwidCIsImhhc093blByb3BlcnR5IiwibG9hZGVyIiwibG9hZFJlcyIsIlNwcml0ZUZyYW1lIiwiZXJyIiwic3ByaXRlRnJhbWUiLCJpbmRleCIsIm9iaiIsInBpYyIsInNjaGVkdWxlT25jZSIsIlNwcml0ZSIsInBhc3NlZEFjdGlvbiIsInNlbGYiLCJQcmVmYWIiLCJwcmVmYWIiLCJhbGVydCIsImluc3RhbnRpYXRlIiwiYWRkQ2hpbGQiLCJzZXRQb3NpdGlvbiIsIkF1ZGlvQ2xpcCIsImNsaXAiLCJhdWRpb0VuZ2luZSIsInBsYXkiLCJhY3RpdmUiLCJzeXMiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiY250IiwiZ2V0SXRlbSIsInBhc3RDbnQiLCJ3aW5kb3ciLCJrdkRhdGFMaXN0Iiwia2V5IiwidmFsdWUiLCJTdHJpbmciLCJ3eCIsInNldFVzZXJDbG91ZFN0b3JhZ2UiLCJLVkRhdGFMaXN0Iiwic3VjY2VzcyIsImUiLCJjb25zb2xlIiwibG9nIiwiZmFpbCIsInVwZGF0ZUFsbCIsInBpZWNlIiwidHlwZSIsImlzSW5SYW5nZSIsImRpc2FibGUiLCJzZXRmbGFnIiwiZ3giLCJneSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7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QmxCOzs7QUFDQSxTQUFJLElBQUkvRSxDQUFSLElBQWEsS0FBS04sTUFBbEIsRUFBMEI7QUFDdEIsVUFBSStFLEtBQUssR0FBRyxLQUFLL0UsTUFBTCxDQUFZTSxDQUFaLENBQVo7O0FBQ0EsVUFBR3lFLEtBQUssQ0FBQ0MsSUFBTixJQUFjLENBQWQsSUFBbUJELEtBQUssQ0FBQ0UsU0FBekIsSUFBc0NGLEtBQUssQ0FBQ0csT0FBTixJQUFpQixLQUExRCxFQUFpRTtBQUM3REgsUUFBQUEsS0FBSyxDQUFDaEUsYUFBTixDQUFvQm5CLEVBQUUsQ0FBQ0UsU0FBdkIsRUFBa0MsQ0FBbEMsRUFBcUNxRixPQUFyQyxDQUE2QyxDQUE3QyxFQUFnREosS0FBSyxDQUFDSyxFQUF0RCxFQUEwREwsS0FBSyxDQUFDTSxFQUFoRTtBQUNIO0FBQ0o7QUFDSjtBQXBQSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog566h55CG5omA5pyJ5qOL5a2Q55qE57G7XHJcbiAqIFxyXG4gKiBAcHJvcGVydHkge2NjLk5vZGVbXX0gbWFwIOWtmOaJgOacieagvOWtkOW8leeUqOeahOaVsOe7hFxyXG4gKiBcclxuICogQHByb3BlcnR5IHtjYy5Ob2RlW119IHBpZWNlcyDlrZjmiYDmnInmo4vlrZDlvJXnlKjnmoTmlbDnu4RcclxuICovXHJcbmNjLkNsYXNzKHtcclxuXHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDliJ3lp4vljJZcclxuICAgICAqL1xyXG4gICAgc3RhcnQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnBpZWNlcyA9IFtdO1xyXG4gICAgICAgIHRoaXMucGllY2VzID0gdGhpcy5ub2RlLmdldENoaWxkcmVuKCk7XHJcblxyXG4gICAgICAgIC8vIOiOt+WPluaJgOacieagvOWtkOWvueixoeeahOW8leeUqFxyXG4gICAgICAgIHRoaXMubWFwID0gdGhpcy5ub2RlLnBhcmVudC5nZXRDb21wb25lbnQoXCJDaGVja2VyQm9hcmRcIikubWFwO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWwhuavj+S4quagvOWtkOeahOW8leeUqOS8oOmAkuWIsOaji+WtkOS4ilxyXG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLnBpZWNlcykge1xyXG4gICAgICAgICAgICB0aGlzLnBpZWNlc1tpXS5ncmlkcyA9IHRoaXMubWFwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5qC55o2u5qC85a2Q55qE54q25oCB54K55Lqu5qC85a2QXHJcbiAgICAgKi9cclxuICAgIGVubGlnaHRlbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGdyaWRzID0gdGhpcy5tYXA7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IDEwOyBqKyspe1xyXG4gICAgICAgICAgICAgICAgdmFyIGdyaWQgPSBncmlkc1tpXVtqXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihncmlkLmZsYWcgPT0gMCkgY29udGludWU7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoZ3JpZC5udW1zID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWQuZmxhZyA9IDI7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyaWQuZmxhZyA9IDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8g5Y+R6YCB5LqL5Lu25L+h5oGv77yM6LCD55SocmVwYWludOaWueazlVxyXG4gICAgICAgICAgICAgICAgZ3JpZC5lbWl0KFwiZmxhZ19jaGFuZ2VkXCIpOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBcclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAmuWFs+WQjuemgeatouaJgOacieaji+WtkOeahOiEmuacrFxyXG4gICAgICovXHJcbiAgICBzdG9wQWN0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5waWVjZXMpIHtcclxuICAgICAgICAgICAgdGhpcy5waWVjZXNbaV0uZ2V0Q29tcG9uZW50cyhjYy5Db21wb25lbnQpWzFdLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgICAvKipcclxuICAgICAqIOajgOafpeaYr+WQpumAmuWFs1xyXG4gICAgICogQHJldHVybnMge0Jvb2xlYW59IOmAmuWFs+i/lOWbnnRydWUsIOWPjeS5i+i/lOWbnmZhbHNlXHJcbiAgICAgKi9cclxuICAgIGNoZWNrUGFzczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGNhbnZhcyA9IGNjLmZpbmQoJ0NhbnZhcycpO1xyXG4gICAgICAgIHZhciBwYXRoID0gY2FudmFzLmdldENvbXBvbmVudHMoY2MuQ29tcG9uZW50KVsxXS5wYXRoO1xyXG4gICAgICAgIHZhciBncmlkcyA9IHRoaXMubWFwO1xyXG5cclxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykge1xyXG4gICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgMTA7IGorKyl7XHJcbiAgICAgICAgICAgICAgICBpZihwYXRoW2ldW2pdID09IDEgJiYgZ3JpZHNbaV1bal0uZmxhZyAhPSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiDov4flhbPliqjnlLvlkYjnjrBcclxuICAgICAqL1xyXG4gICAgc2hvdzogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIGNhbnZhcyA9IGNjLmZpbmQoJ0NhbnZhcycpO1xyXG4gICAgICAgIHZhciBncmlkcyA9IHRoaXMubWFwO1xyXG4gICAgICAgIHZhciBwYXRoID0gY2FudmFzLmdldENvbXBvbmVudHMoY2MuQ29tcG9uZW50KVsxXS5wYXRoO1xyXG5cclxuICAgICAgICAvLyDmn6Xmib7otbflp4vngrlcclxuICAgICAgICB2YXIgYmVnaW4gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDEwOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICBpZihwYXRoWzldW2ldID09IDEpIHJldHVybiBjYy52Mig5LCBpKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKHZhciBpID0gOTsgaSA+PSAwOyBpLS0gKSB7XHJcbiAgICAgICAgICAgICAgICBpZihwYXRoW2ldWzBdID09IDEpIHJldHVybiBjYy52MihpLCAwKTsgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAxMDsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgaWYocGF0aFswXVtpXSA9PSAxKSByZXR1cm4gY2MudjIoMCwgaSk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAxMDsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgaWYocGF0aFtpXVs5XSA9PSAxKSByZXR1cm4gY2MudjIoaSwgOSk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0oKTtcclxuXHJcbiAgICAgICAgLy8g6aG65bqP6I635Y+W6Lev5b6E5LiK5q+P5qC8XHJcbiAgICAgICAgdmFyIGRpcnggPSBuZXcgQXJyYXkoMCwgMSwgMCwgLTEpO1xyXG4gICAgICAgIHZhciBkaXJ5ID0gbmV3IEFycmF5KDEsIDAsIC0xLCAwKTtcclxuICAgICAgICB2YXIgdmlzdCA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgIHZhciBwYWludCA9IG5ldyBBcnJheSgpO1xyXG5cclxuICAgICAgICB2aXN0W2JlZ2luXSA9IHRydWU7XHJcbiAgICAgICAgZm9yKHZhciBueCA9IGJlZ2luLngsIG55ID0gYmVnaW4ueTs7KSB7XHJcbiAgICAgICAgICAgIHBhaW50LnB1c2goZ3JpZHNbbnhdW255XSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgeCA9IG54ICsgZGlyeFtpXTtcclxuICAgICAgICAgICAgICAgIHZhciB5ID0gbnkgKyBkaXJ5W2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIHQgPSBjYy52Mih4LCB5KTtcclxuICAgICAgICAgICAgICAgIGlmKHggPCAxMCAmJiB4ID49IDAgJiYgeSA8IDEwICYmIHkgPj0gMCAmJiBcclxuICAgICAgICAgICAgICAgICAgICBwYXRoW3hdW3ldID09IDEgJiYgIXZpc3QuaGFzT3duUHJvcGVydHkodCkpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aXN0W3RdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBueCA9IHgsIG55ID0geTtcclxuICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyDlvZPliY3lt7Lnu4/mmK/mnIDlkI7kuIDkuKrmoLzlrZBcclxuICAgICAgICAgICAgaWYoIWZsYWcpIGJyZWFrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5pu05pS55qC85a2Q6IOM5pmvXHJcbiAgICAgICAgY2MubG9hZGVyLmxvYWRSZXMoXCJncmlkL3Bhc3NcIiwgY2MuU3ByaXRlRnJhbWUsIGZ1bmN0aW9uIChlcnIsIHNwcml0ZUZyYW1lKSB7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGluZGV4IGluIHBhaW50KSB7XHJcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24oaW5kZXgsIG9iaiwgcGljKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6YCa6L+H5Zue6LCD5Ye95pWw6Ze06ZqU5pu05o2i6IOM5pmvXHJcbiAgICAgICAgICAgICAgICAgICAgb2JqLmdldENvbXBvbmVudCgnR3JpZCcpLnNjaGVkdWxlT25jZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iai5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHBpYztcclxuICAgICAgICAgICAgICAgICAgICB9LCBpbmRleCAqIDAuMDE4KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KShpbmRleCwgcGFpbnRbaW5kZXhdLCBzcHJpdGVGcmFtZSk7IFxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgJrlhbPlkI7miafooYzooYzkuLpcclxuICAgICAqL1xyXG4gICAgcGFzc2VkQWN0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAvLyDnpoHmraLmo4vlrZDmi5bliqhcclxuICAgICAgICB0aGlzLnN0b3BBY3Rpb24oKTtcclxuXHJcbiAgICAgICAgLy8g6L+H5YWz5by556qXXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLm5vZGU7XHJcbiAgICAgICAgY2MubG9hZGVyLmxvYWRSZXMoXCJhbGVydFwiLCBjYy5QcmVmYWIsIGZ1bmN0aW9uKGVyciwgcHJlZmFiKSB7XHJcbiAgICAgICAgICAgIHZhciBhbGVydCA9ICBjYy5pbnN0YW50aWF0ZShwcmVmYWIpO1xyXG4gICAgICAgICAgICBzZWxmLnBhcmVudC5hZGRDaGlsZChhbGVydCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIGFsZXJ0LnNldFBvc2l0aW9uKGNjLnYyKDAsIC00NTIuNSkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNob3coKTtcclxuXHJcbiAgICAgICAgLy8g6YCa5YWz6Z+z5pWIXHJcbiAgICAgICAgY2MubG9hZGVyLmxvYWRSZXMoXCJtdXNpYy9wYXNzXCIsIGNjLkF1ZGlvQ2xpcCwgZnVuY3Rpb24gKGVyciwgY2xpcCkge1xyXG4gICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5KGNsaXAsIGZhbHNlLCAxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8g56aB55So5biu5Yqp5oyJ6ZKuXHJcbiAgICAgICAgaWYoY2MuZmluZCgnQ2FudmFzL1RpcEJ1dHRvbicpKVxyXG4gICAgICAgICAgICBjYy5maW5kKCdDYW52YXMvVGlwQnV0dG9uJykuYWN0aXZlID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vIOiusOW9lemAmui/h+eahOWFs+WNoeWIsOe8k+WtmFxyXG4gICAgICAgIHZhciBjYW52YXMgPSBjYy5maW5kKCdDYW52YXMnKTtcclxuICAgICAgICB2YXIgaW5kZXggPSBjYW52YXMuZ2V0Q29tcG9uZW50cyhjYy5Db21wb25lbnQpWzFdLmluZGV4O1xyXG4gICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnTGV2ZWwnICsgaW5kZXgsIHRydWUpO1xyXG5cclxuICAgICAgICAvLyDmm7TmlrDnvJPlrZjpgJrlhbPmgLvmlbBcclxuICAgICAgICB2YXIgY250ID0gMDtcclxuICAgICAgICBmb3IodmFyIGkgPSAxOyBpIDw9IDQ1OyBpKyspIHtcclxuICAgICAgICAgICAgaWYoY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKCdMZXZlbCcgKyBpKSkge1xyXG4gICAgICAgICAgICAgICAgY250Kys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHBhc3RDbnQgPSBjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RvdGFsUGFzc2VkJyk7XHJcbiAgICAgICAgaWYocGFzdENudCA9PSBudWxsICYmIHBhc3RDbnQgPCBjbnQpIHtcclxuICAgICAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b3RhbFBhc3NlZCcsIGNudCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBUWOS6keWtmOWCqOW9k+WJjeeUqOaIt+eahOaAu+i/h+WFs+aVsFxyXG4gICAgICAgIGlmICh3aW5kb3dbJ3d4J10pe1xyXG4gICAgICAgICAgICB2YXIga3ZEYXRhTGlzdCA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICBrdkRhdGFMaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgLy/moIfnrb4g5a2Y5YKo55qE5b2T5YmN5ri45oiP56eN57G755qE5qCH562+XHJcbiAgICAgICAgICAgICAgICBrZXk6ICd0b3RhbFBhc3NlZCcsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogU3RyaW5nKGNudCksXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgd3guc2V0VXNlckNsb3VkU3RvcmFnZSh7XHJcbiAgICAgICAgICAgICAgICBLVkRhdGFMaXN0Omt2RGF0YUxpc3QsXHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzKGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflkJF3eOWtmOWCqOeUqOaIt+aVsOaNruaIkOWKnycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZhaWwoZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WQkXd45a2Y5YKo55So5oi35pWw5o2u5aSx6LSlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmm7TmlrDmiYDmnInmo4vlrZBcclxuICAgICAqL1xyXG4gICAgdXBkYXRlQWxsOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgLy8g6YeN572u5pa55qC8XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcclxuICAgICAgICAgICAgZm9yKHZhciBqID0gMDsgaiA8IDEwOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubWFwW2ldW2pdLm51bXMgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgIFxyXG5cclxuICAgICAgICAvLyDlsIbmo4vnm5jlhoXmiYDmnInnuqLmo4vorr7kuLrnlJ/mlYhcclxuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5waWVjZXMpIHtcclxuICAgICAgICAgICAgdmFyIHBpZWNlID0gdGhpcy5waWVjZXNbaV07XHJcbiAgICAgICAgICAgIGlmKHBpZWNlLnR5cGUgPT0gMCAmJiBwaWVjZS5pc0luUmFuZ2UpIHtcclxuICAgICAgICAgICAgICAgIHBpZWNlLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8g5pu05paw6buR5qOL5Lul56aB55So5Y+X5pS75Ye755qE57qi5qOLXHJcbiAgICAgICAgZm9yKHZhciBpIGluIHRoaXMucGllY2VzKSB7XHJcbiAgICAgICAgICAgIHZhciBwaWVjZSA9IHRoaXMucGllY2VzW2ldO1xyXG4gICAgICAgICAgICBpZihwaWVjZS50eXBlID09IDEpIHtcclxuICAgICAgICAgICAgICAgIHBpZWNlLmdldENvbXBvbmVudHMoY2MuQ29tcG9uZW50KVsxXS5zZXRmbGFnKHBpZWNlLmd4LCBwaWVjZS5neSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIOabtOaWsOe6ouaji1xyXG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLnBpZWNlcykge1xyXG4gICAgICAgICAgICB2YXIgcGllY2UgPSB0aGlzLnBpZWNlc1tpXTtcclxuICAgICAgICAgICAgaWYocGllY2UudHlwZSA9PSAwICYmIHBpZWNlLmlzSW5SYW5nZSAmJiBwaWVjZS5kaXNhYmxlID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICBwaWVjZS5nZXRDb21wb25lbnRzKGNjLkNvbXBvbmVudClbMV0uc2V0ZmxhZygxLCBwaWVjZS5neCwgcGllY2UuZ3kpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxufSk7XHJcbiJdfQ==