{"version":3,"sources":["assets\\scripts\\PieceManager.js"],"names":["cc","Class","Component","start","pieces","node","getChildren","map","parent","getComponent","i","grids","enlighten","j","grid","flag","nums","emit","stopAction","getComponents","destroy","checkPass","canvas","find","path","show","begin","v2","dirx","Array","diry","vist","paint","nx","x","ny","y","push","t","hasOwnProperty","loader","loadRes","SpriteFrame","err","spriteFrame","index","obj","pic","scheduleOnce","Sprite","passedAction","self","Prefab","prefab","alert","instantiate","addChild","setPosition","AudioClip","clip","audioEngine","play","active","sys","localStorage","setItem","cnt","getItem","pastCnt","window","kvDataList","key","value","String","wx","setUserCloudStorage","KVDataList","success","e","console","log","fail","updateAll","piece","type","isInRange","disable","setflag","gx","gy"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * 管理所有棋子的类\r\n * \r\n * @property {cc.Node[]} map 存所有格子引用的数组\r\n * \r\n * @property {cc.Node[]} pieces 存所有棋子引用的数组\r\n */\r\ncc.Class({\r\n\r\n    extends: cc.Component,\r\n\r\n    /**\r\n     * 初始化\r\n     */\r\n    start: function () {\r\n        this.pieces = [];\r\n        this.pieces = this.node.getChildren();\r\n\r\n        // 获取所有格子对象的引用\r\n        this.map = this.node.parent.getComponent(\"CheckerBoard\").map;\r\n        \r\n        // 将每个格子的引用传递到棋子上\r\n        for(var i in this.pieces) {\r\n            this.pieces[i].grids = this.map;\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * 根据格子的状态点亮格子\r\n     */\r\n    enlighten: function() {\r\n        var grids = this.map;\r\n        for(var i = 0; i < 10; i++) {\r\n            for(var j = 0; j < 10; j++){\r\n                var grid = grids[i][j];\r\n            \r\n                if(grid.flag == 0) continue;\r\n\r\n                if(grid.nums > 0) {\r\n                    grid.flag = 2;\r\n                } else {\r\n                    grid.flag = 1;\r\n                }\r\n\r\n                // 发送事件信息，调用repaint方法\r\n                grid.emit(\"flag_changed\"); \r\n            }\r\n        }\r\n    },\r\n    \r\n\r\n    /**\r\n     * 通关后禁止所有棋子的脚本\r\n     */\r\n    stopAction: function() {\r\n        for(var i in this.pieces) {\r\n            this.pieces[i].getComponents(cc.Component)[1].destroy();\r\n        }\r\n    },\r\n\r\n     /**\r\n     * 检查是否通关\r\n     * @returns {Boolean} 通关返回true, 反之返回false\r\n     */\r\n    checkPass: function() {\r\n        var canvas = cc.find('Canvas');\r\n        var path = canvas.getComponents(cc.Component)[1].path;\r\n        var grids = this.map;\r\n\r\n        for(var i = 0; i < 10; i++) {\r\n            for(var j = 0; j < 10; j++){\r\n                if(path[i][j] == 1 && grids[i][j].flag != 2) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n    \r\n    /**\r\n     * 过关动画呈现\r\n     */\r\n    show: function() {\r\n        var canvas = cc.find('Canvas');\r\n        var grids = this.map;\r\n        var path = canvas.getComponents(cc.Component)[1].path;\r\n\r\n        // 查找起始点\r\n        var begin = function() {\r\n            for(var i = 0; i < 10; i++ ) {\r\n                if(path[9][i] == 1) return cc.v2(9, i); \r\n            }\r\n            for(var i = 9; i >= 0; i-- ) {\r\n                if(path[i][0] == 1) return cc.v2(i, 0); \r\n            }\r\n\r\n            for(var i = 0; i < 10; i++ ) {\r\n                if(path[0][i] == 1) return cc.v2(0, i); \r\n            }\r\n            for(var i = 0; i < 10; i++ ) {\r\n                if(path[i][9] == 1) return cc.v2(i, 9); \r\n            }\r\n            return null;\r\n        }();\r\n\r\n        // 顺序获取路径上每格\r\n        var dirx = new Array(0, 1, 0, -1);\r\n        var diry = new Array(1, 0, -1, 0);\r\n        var vist = new Array();\r\n        var paint = new Array();\r\n\r\n        vist[begin] = true;\r\n        for(var nx = begin.x, ny = begin.y;;) {\r\n            paint.push(grids[nx][ny]);\r\n\r\n            var flag = false;\r\n            for(var i = 0; i < 4; i++) {\r\n                var x = nx + dirx[i];\r\n                var y = ny + diry[i];\r\n                var t = cc.v2(x, y);\r\n                if(x < 10 && x >= 0 && y < 10 && y >= 0 && \r\n                    path[x][y] == 1 && !vist.hasOwnProperty(t)) {\r\n                    vist[t] = true;\r\n                    nx = x, ny = y;\r\n                    flag = true;\r\n                    break;\r\n                }\r\n            }\r\n            // 当前已经是最后一个格子\r\n            if(!flag) break;\r\n        }\r\n\r\n        // 更改格子背景\r\n        cc.loader.loadRes(\"grid/pass\", cc.SpriteFrame, function (err, spriteFrame) {\r\n\r\n            for(var index in paint) {\r\n                (function(index, obj, pic) {\r\n                    // 通过回调函数间隔更换背景\r\n                    obj.getComponent('Grid').scheduleOnce(() => {\r\n                        obj.getComponent(cc.Sprite).spriteFrame = pic;\r\n                    }, index * 0.018);\r\n\r\n                })(index, paint[index], spriteFrame); \r\n                \r\n            }\r\n        });\r\n    },\r\n\r\n    /**\r\n     * 通关后执行行为\r\n     */\r\n    passedAction: function() {\r\n        // 禁止棋子拖动\r\n        this.stopAction();\r\n\r\n        // 过关弹窗\r\n        var self = this.node;\r\n        cc.loader.loadRes(\"alert\", cc.Prefab, function(err, prefab) {\r\n            var alert =  cc.instantiate(prefab);\r\n            self.parent.addChild(alert);\r\n        \r\n            alert.setPosition(cc.v2(0, -452.5));\r\n        });\r\n\r\n        this.show();\r\n\r\n        // 通关音效\r\n        cc.loader.loadRes(\"music/pass\", cc.AudioClip, function (err, clip) {\r\n            cc.audioEngine.play(clip, false, 1);\r\n        });\r\n\r\n        // 禁用帮助按钮\r\n        if(cc.find('Canvas/TipButton'))\r\n            cc.find('Canvas/TipButton').active = false;\r\n\r\n        // 记录通过的关卡到缓存\r\n        var canvas = cc.find('Canvas');\r\n        var index = canvas.getComponents(cc.Component)[1].index;\r\n        cc.sys.localStorage.setItem('Level' + index, true);\r\n\r\n        // 更新缓存通关总数\r\n        var cnt = 0;\r\n        for(var i = 1; i <= 45; i++) {\r\n            if(cc.sys.localStorage.getItem('Level' + i)) {\r\n                cnt++;\r\n            }\r\n        }\r\n        var pastCnt = cc.sys.localStorage.getItem('totalPassed');\r\n        if(pastCnt == null && pastCnt < cnt) {\r\n            cc.sys.localStorage.setItem('totalPassed', cnt);\r\n        }\r\n\r\n        // TX云存储当前用户的总过关数\r\n        if (window['wx']){\r\n            var kvDataList = new Array();\r\n            kvDataList.push({\r\n                //标签 存储的当前游戏种类的标签\r\n                key: 'totalPassed',\r\n                value: String(cnt),\r\n            });\r\n\r\n            wx.setUserCloudStorage({\r\n                KVDataList:kvDataList,\r\n                success(e){\r\n                    console.log('向wx存储用户数据成功');\r\n                    console.log(e);\r\n                },\r\n                fail(e){\r\n                    console.log('向wx存储用户数据失败');\r\n                    console.log(e);\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 更新所有棋子\r\n     */\r\n    updateAll: function() {\r\n\r\n        // 重置方格\r\n        for(var i = 0; i < 10; i++) {\r\n            for(var j = 0; j < 10; j++) {\r\n                this.map[i][j].nums = 0;\r\n            }\r\n        }   \r\n\r\n        // 将棋盘内所有红棋设为生效\r\n        for(var i in this.pieces) {\r\n            var piece = this.pieces[i];\r\n            if(piece.type == 0 && piece.isInRange) {\r\n                piece.disable = false;\r\n            }\r\n        }\r\n\r\n        // 更新黑棋以禁用受攻击的红棋\r\n        for(var i in this.pieces) {\r\n            var piece = this.pieces[i];\r\n            if(piece.type == 1) {\r\n                piece.getComponents(cc.Component)[1].setflag(piece.gx, piece.gy);\r\n            }\r\n        }\r\n\r\n        // 更新红棋\r\n        for(var i in this.pieces) {\r\n            var piece = this.pieces[i];\r\n            if(piece.type == 0 && piece.isInRange && piece.disable == false) {\r\n                piece.getComponents(cc.Component)[1].setflag(1, piece.gx, piece.gy);\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}