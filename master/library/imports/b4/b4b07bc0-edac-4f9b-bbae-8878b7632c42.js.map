{"version":3,"sources":["assets\\scripts\\PieceManager.js"],"names":["cc","Class","Component","start","pieces","node","getChildren","map","parent","getComponent","i","grids","enlighten","j","grid","flag","nums","emit","stopAction","getComponents","destroy","checkPass","canvas","find","path","show","begin","v2","dirx","Array","diry","vist","paint","nx","x","ny","y","push","t","hasOwnProperty","loader","loadRes","SpriteFrame","err","spriteFrame","index","obj","pic","scheduleOnce","Sprite","passedAction","self","Prefab","prefab","alert","instantiate","addChild","setPosition","AudioClip","clip","audioEngine","play","zIndex","active","sys","localStorage","setItem","cnt","getItem","pastCnt","window","kvDataList","key","value","String","wx","setUserCloudStorage","KVDataList","success","e","console","log","fail","updateAll","piece","type","isInRange","disable","setflag","gx","gy"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\n * 管理所有棋子的类\n * \n * @property {cc.Node[]} map 存所有格子引用的数组\n * \n * @property {cc.Node[]} pieces 存所有棋子引用的数组\n */\ncc.Class({\n\n    extends: cc.Component,\n\n    /**\n     * 初始化\n     */\n    start: function () {\n        this.pieces = [];\n        this.pieces = this.node.getChildren();\n\n        // 获取所有格子对象的引用\n        this.map = this.node.parent.getComponent(\"CheckerBoard\").map;\n        \n        // 将每个格子的引用传递到棋子上\n        for(var i in this.pieces) {\n            this.pieces[i].grids = this.map;\n        }\n\n    },\n\n    /**\n     * 根据格子的状态点亮格子\n     */\n    enlighten: function() {\n        var grids = this.map;\n        for(var i = 0; i < 10; i++) {\n            for(var j = 0; j < 10; j++){\n                var grid = grids[i][j];\n            \n                if(grid.flag == 0) continue;\n\n                if(grid.nums > 0) {\n                    grid.flag = 2;\n                } else {\n                    grid.flag = 1;\n                }\n\n                // 发送事件信息，调用repaint方法\n                grid.emit(\"flag_changed\"); \n            }\n        }\n    },\n    \n\n    /**\n     * 通关后禁止所有棋子的脚本\n     */\n    stopAction: function() {\n        for(var i in this.pieces) {\n            this.pieces[i].getComponents(cc.Component)[1].destroy();\n        }\n    },\n\n     /**\n     * 检查是否通关\n     * @returns {Boolean} 通关返回true, 反之返回false\n     */\n    checkPass: function() {\n        var canvas = cc.find('Canvas');\n        var path = canvas.getComponents(cc.Component)[1].path;\n        var grids = this.map;\n\n        for(var i = 0; i < 10; i++) {\n            for(var j = 0; j < 10; j++){\n                if(path[i][j] == 1 && grids[i][j].flag != 2) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    },\n    \n    /**\n     * 过关动画呈现\n     */\n    show: function() {\n        var canvas = cc.find('Canvas');\n        var grids = this.map;\n        var path = canvas.getComponents(cc.Component)[1].path;\n\n        // 查找起始点\n        var begin = function() {\n            for(var i = 0; i < 10; i++ ) {\n                if(path[9][i] == 1) return cc.v2(9, i); \n            }\n            for(var i = 9; i >= 0; i-- ) {\n                if(path[i][0] == 1) return cc.v2(i, 0); \n            }\n\n            for(var i = 0; i < 10; i++ ) {\n                if(path[0][i] == 1) return cc.v2(0, i); \n            }\n            for(var i = 0; i < 10; i++ ) {\n                if(path[i][9] == 1) return cc.v2(i, 9); \n            }\n            return null;\n        }();\n\n        // 顺序获取路径上每格\n        var dirx = new Array(0, 1, 0, -1);\n        var diry = new Array(1, 0, -1, 0);\n        var vist = new Array();\n        var paint = new Array();\n\n        vist[begin] = true;\n        for(var nx = begin.x, ny = begin.y;;) {\n            paint.push(grids[nx][ny]);\n\n            var flag = false;\n            for(var i = 0; i < 4; i++) {\n                var x = nx + dirx[i];\n                var y = ny + diry[i];\n                var t = cc.v2(x, y);\n                if(x < 10 && x >= 0 && y < 10 && y >= 0 && \n                    path[x][y] == 1 && !vist.hasOwnProperty(t)) {\n                    vist[t] = true;\n                    nx = x, ny = y;\n                    flag = true;\n                    break;\n                }\n            }\n            // 当前已经是最后一个格子\n            if(!flag) break;\n        }\n\n        // 更改格子背景\n        cc.loader.loadRes(\"grid/pass\", cc.SpriteFrame, function (err, spriteFrame) {\n\n            for(var index in paint) {\n                (function(index, obj, pic) {\n                    // 通过回调函数间隔更换背景\n                    obj.getComponent('Grid').scheduleOnce(() => {\n                        obj.getComponent(cc.Sprite).spriteFrame = pic;\n                    }, index * 0.018);\n\n                })(index, paint[index], spriteFrame); \n                \n            }\n        });\n    },\n\n    /**\n     * 通关后执行行为\n     */\n    passedAction: function() {\n        // 禁止棋子拖动\n        this.stopAction();\n\n        // 过关弹窗\n        var self = this.node;\n        cc.loader.loadRes(\"alert\", cc.Prefab, function(err, prefab) {\n            var alert =  cc.instantiate(prefab);\n            self.parent.addChild(alert);\n        \n            alert.setPosition(cc.v2(0, -452.5));\n        });\n\n        this.show();\n\n        // 通关音效\n        cc.loader.loadRes(\"music/pass\", cc.AudioClip, function (err, clip) {\n            cc.audioEngine.play(clip, false, 1);\n        });\n\n        // 加载文字科普\n        cc.loader.loadRes(\"describe/1\", cc.Prefab, function(err, prefab) {\n            var alert =  cc.instantiate(prefab);\n            // 设置节点层级在最上层\n            alert.zIndex = 100;\n            self.parent.addChild(alert);\n            alert.setPosition(cc.v2(100, -100));\n        });\n\n        // 禁用帮助按钮\n        if(cc.find('Canvas/TipButton'))\n            cc.find('Canvas/TipButton').active = false;\n\n        // 记录通过的关卡到缓存\n        var canvas = cc.find('Canvas');\n        var index = canvas.getComponents(cc.Component)[1].index;\n        cc.sys.localStorage.setItem('Level' + index, true);\n\n        // 更新缓存通关总数\n        var cnt = 0;\n        for(var i = 1; i <= 45; i++) {\n            if(cc.sys.localStorage.getItem('Level' + i)) {\n                cnt++;\n            }\n        }\n        var pastCnt = cc.sys.localStorage.getItem('totalPassed');\n        if(pastCnt == null && pastCnt < cnt) {\n            cc.sys.localStorage.setItem('totalPassed', cnt);\n        }\n\n        // TX云存储当前用户的总过关数\n        if (window['wx']){\n            var kvDataList = new Array();\n            kvDataList.push({\n                //标签 存储的当前游戏种类的标签\n                key: 'totalPassed',\n                value: String(cnt),\n            });\n\n            wx.setUserCloudStorage({\n                KVDataList:kvDataList,\n                success(e){\n                    console.log('向wx存储用户数据成功');\n                    console.log(e);\n                },\n                fail(e){\n                    console.log('向wx存储用户数据失败');\n                    console.log(e);\n                }\n            });\n        }\n    },\n\n    /**\n     * 更新所有棋子\n     */\n    updateAll: function() {\n\n        // 重置方格\n        for(var i = 0; i < 10; i++) {\n            for(var j = 0; j < 10; j++) {\n                this.map[i][j].nums = 0;\n            }\n        }   \n\n        // 将棋盘内所有红棋设为生效\n        for(var i in this.pieces) {\n            var piece = this.pieces[i];\n            if(piece.type == 0 && piece.isInRange) {\n                piece.disable = false;\n            }\n        }\n\n        // 更新黑棋以禁用受攻击的红棋\n        for(var i in this.pieces) {\n            var piece = this.pieces[i];\n            if(piece.type == 1) {\n                piece.getComponents(cc.Component)[1].setflag(piece.gx, piece.gy);\n            }\n        }\n\n        // 更新红棋\n        for(var i in this.pieces) {\n            var piece = this.pieces[i];\n            if(piece.type == 0 && piece.isInRange && piece.disable == false) {\n                piece.getComponents(cc.Component)[1].setflag(1, piece.gx, piece.gy);\n            }\n        }\n    },\n});\n"]}